{% extends base_template %}
{% load i18n admission enums static %}

{% comment "License" %}
* OSIS stands for Open Student Information System. It's an application
* designed to manage the core business of higher education institutions,
* such as universities, faculties, institutes and professional schools.
* The core business involves the administration of students, teachers,
* courses, programs and so on.
*
* Copyright (C) 2015-2022 Université catholique de Louvain (http://www.uclouvain.be)
*
* This program is free software: you can redistribute it and/or modify
* it under the terms of the GNU General Public License as published by
* the Free Software Foundation, either version 3 of the License, or
* (at your option) any later version.
*
* This program is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
* GNU General Public License for more details.
*
* A copy of this license - GNU General Public License - is available
* at the root of the source code of this program.  If not,
* see http://www.gnu.org/licenses/.
{% endcomment %}

{% block tab_content %}
  {% if accounting.derniers_etablissements_superieurs_communaute_fr_frequentes %}
    {% blocktranslate trimmed with academic_year=accounting.derniers_etablissements_superieurs_communaute_fr_frequentes.academic_year|get_academic_year names=accounting.derniers_etablissements_superieurs_communaute_fr_frequentes.names|join:', ' count counter=accounting.derniers_etablissements_superieurs_communaute_fr_frequentes.names|length asvar absence_of_debt_label %}
      Certificate stating the absence of debts towards the institution attended during the academic year {{ academic_year}}: {{ names }}.
      {% plural %}
      Certificates stating the absence of debts towards the institutions attended during the academic year {{ academic_year}}: {{ names }}.
    {% endblocktranslate %}
    {% panel _('Absence of debt') %}
      {% field_data absence_of_debt_label accounting.attestation_absence_dette_etablissement %}
    {% endpanel %}
  {% endif %}

  {% if is_general %}
    {% panel _('Reduced registration fees') %}
      {% field_data _('Have you applied for a study allowance from the French Community of Belgium?') accounting.demande_allocation_d_etudes_communaute_francaise_belgique %}
      {% field_data _('Are you the child of a member of the staff of the UCLouvain or the Martin V entity?') accounting.enfant_personnel %}
      {% if accounting.enfant_personnel %}
        <div>
          {% field_data _('Staff child certificate') accounting.attestation_enfant_personnel %}
          <p>
            {% blocktranslate trimmed %}
              The child of a member of staff may, under some conditions, benefit from a reduction of the registration fee for
              any registration for a bachelor's or master's degree. This parent should contact the Human Resources
              Administration of his or her employer to check whether he or she meets these conditions and, if so,
              request the certificate confirming this.
            {% endblocktranslate %}
          </p>
        </div>
      {% endif %}
    {% endpanel %}
  {% endif %}

  {% if with_assimilation %}
    {% panel _('Assimilation') %}
      {% if accounting.type_situation_assimilation == 'AUCUNE_ASSIMILATION' %}
        {% translate 'You specified that no assimilation proposals applies to you.' %}

      {% elif accounting.type_situation_assimilation == 'AUTORISATION_ETABLISSEMENT_OU_RESIDENT_LONGUE_DUREE' %}
        {% field_data _('Chosen assimilation') accounting.sous_type_situation_assimilation_1|enum_display:'ChoixAssimilation1' %}

        {% if accounting.sous_type_situation_assimilation_1 == 'TITULAIRE_CARTE_RESIDENT_LONGUE_DUREE' %}
          {% field_data _('Copy of both sides of the EC long-term resident card (D card)') accounting.carte_resident_longue_duree %}
        {% elif accounting.sous_type_situation_assimilation_1 == 'TITULAIRE_CARTE_ETRANGER' %}
          {% field_data _("Copy of both sides of the CIRE - unlimited stay (B card) or copy of the foreigner's card - unlimited stay (C card)") accounting.carte_cire_sejour_illimite_etranger %}
        {% elif accounting.sous_type_situation_assimilation_1 == 'TITULAIRE_CARTE_SEJOUR_MEMBRE_UE' %}
          {% field_data _('Copy of both sides of the residence card of a family member of a European Union citizen (F card)') accounting.carte_sejour_membre_ue %}
        {% elif accounting.sous_type_situation_assimilation_1 == 'TITULAIRE_CARTE_SEJOUR_PERMANENT_MEMBRE_UE' %}
          {% field_data _('Copy of both sides of the permanent residence card of a family member of a European Union citizen (F+ card)') accounting.carte_sejour_permanent_membre_ue %}
        {% endif %}

      {% elif accounting.type_situation_assimilation == 'REFUGIE_OU_APATRIDE_OU_PROTECTION_SUBSIDIAIRE_TEMPORAIRE' %}
        {% field_data _('Chosen assimilation') accounting.sous_type_situation_assimilation_2|enum_display:'ChoixAssimilation2' %}

        {% if accounting.sous_type_situation_assimilation_2 == 'REFUGIE' %}
          {% field_data _('Copy of both sides of the A or B card (with "refugee" written on the back of the card)') accounting.carte_a_b_refugie %}
        {% elif accounting.sous_type_situation_assimilation_2 == 'DEMANDEUR_ASILE' %}
          {% field_data _('Copy of the Annex 25 or 26 completed by the Office of the Commissioner General for Refugees and Stateless Persons') accounting.annexe_25_26_refugies_apatrides %}
          {% field_data _('Copy of the registration certificate "orange card"') accounting.attestation_immatriculation %}
        {% elif accounting.sous_type_situation_assimilation_2 == 'PROTECTION_SUBSIDIAIRE' %}
          {% field_data _('Copy of both sides of the A or B Card') accounting.carte_a_b %}
          {% field_data _("Copy of the decision of the Foreigners' Office confirming the granting of subsidiary protection") accounting.decision_protection_subsidiaire %}
        {% elif accounting.sous_type_situation_assimilation_2 == 'PROTECTION_TEMPORAIRE' %}
          {% field_data _("Copy of the decision of the Foreigners' Office confirming the granting of temporary protection") accounting.decision_protection_temporaire %}
        {% endif %}

      {% elif accounting.type_situation_assimilation == 'AUTORISATION_SEJOUR_ET_REVENUS_PROFESSIONNELS_OU_REMPLACEMENT' %}
        {% field_data _('Chosen assimilation') accounting.sous_type_situation_assimilation_3|enum_display:'ChoixAssimilation3' %}

        {% if accounting.sous_type_situation_assimilation_3 == 'AUTORISATION_SEJOUR_ET_REVENUS_PROFESSIONNELS' %}
          {% field_data _('Copy of both sides of the residence permit valid for more than 3 months') accounting.titre_sejour_3_mois_professionel %}
          {% field_data _('Copy of 6 salary slips issued in the 12 months preceding the application') accounting.fiches_remuneration %}
        {% elif accounting.sous_type_situation_assimilation_3 == 'AUTORISATION_SEJOUR_ET_REVENUS_DE_REMPLACEMENT' %}
          {% field_data _('Copy of both sides of the residence permit valid for more than 3 months') accounting.titre_sejour_3_mois_remplacement %}
          {% field_data _('Proof of receipt of unemployment benefit, pension or compensation from the mutual insurance company') accounting.preuve_allocations_chomage_pension_indemnite %}
        {% endif %}

      {% elif accounting.type_situation_assimilation == 'PRIS_EN_CHARGE_OU_DESIGNE_CPAS' %}
        {% field_data _('Chosen assimilation') accounting.type_situation_assimilation|enum_display:'TypeSituationAssimilation' %}

        {% field_data _('Recent certificate of support from the CPAS') accounting.attestation_cpas %}

      {% elif accounting.type_situation_assimilation == 'PROCHE_A_NATIONALITE_UE_OU_RESPECTE_ASSIMILATIONS_1_A_4' %}
        {% interpolate accounting.sous_type_situation_assimilation_5|enum_display:'ChoixAssimilation5' person_concerned=accounting.relation_parente|enum_display:'LienParente' as chosen_assimilation_5 %}
        {% field_data _('Chosen assimilation') chosen_assimilation_5 %}
        {% if accounting.relation_parente == 'PERE' or accounting.relation_parente == 'MERE' %}
          {% field_data _('Household composition, or a copy of your birth certificate') accounting.composition_menage_acte_naissance %}
        {% elif accounting.relation_parente == 'TUTEUR_LEGAL' %}
          {% field_data _('Copy of the tutorship act authenticated by the Belgian authorities') accounting.acte_tutelle %}
        {% elif accounting.relation_parente == 'CONJOINT' %}
          {% field_data _('Household composition or marriage certificate authenticated by the Belgian authorities') accounting.composition_menage_acte_mariage %}
        {% elif accounting.relation_parente == 'COHABITANT_LEGAL' %}
          {% field_data _('Certificate of legal cohabitation') accounting.attestation_cohabitation_legale %}
        {% endif %}

        {% if accounting.sous_type_situation_assimilation_5 == 'A_NATIONALITE_UE' %}
          {% blocktranslate with person_concerned=formatted_relationship trimmed asvar carte_identite_parent_label %}
            Copy of both sides of the identity card of {{ person_concerned }}
          {% endblocktranslate %}
          {% field_data carte_identite_parent_label accounting.carte_identite_parent %}
        {% elif accounting.sous_type_situation_assimilation_5 == 'TITULAIRE_TITRE_SEJOUR_LONGUE_DUREE' %}
          {% blocktranslate with person_concerned=formatted_relationship trimmed asvar titre_sejour_longue_duree_parent_label %}
            Copy of both sides of the long-term residence permit in Belgium of {{ person_concerned }} (B, C, D, F, F+ or M cards)
          {% endblocktranslate %}
          {% field_data titre_sejour_longue_duree_parent_label accounting.titre_sejour_longue_duree_parent %}
        {% elif accounting.sous_type_situation_assimilation_5 == 'CANDIDATE_REFUGIE_OU_REFUGIE_OU_APATRIDE_OU_PROTECTION_SUBSIDIAIRE_TEMPORAIRE' %}
          {% blocktranslate with person_concerned=formatted_relationship trimmed asvar annexe_25_26_refugies_apatrides_decision_protection_parent_label %}
            Copy of the Annex 25 or 26 or the A/B card mentioning the refugee status or copy of the decision of the
            Foreigners' Office confirming the temporary/subsidiary protection of {{ person_concerned }}
          {% endblocktranslate %}
          {% field_data annexe_25_26_refugies_apatrides_decision_protection_parent_label accounting.annexe_25_26_refugies_apatrides_decision_protection_parent %}
        {% elif accounting.sous_type_situation_assimilation_5 == 'AUTORISATION_SEJOUR_ET_REVENUS_PROFESSIONNELS_OU_REMPLACEMENT' %}
          {% blocktranslate with person_concerned=formatted_relationship trimmed asvar titre_sejour_3_mois_parent_label %}
            Copy of both sides of the residence permit valid for more than 3 months of {{ person_concerned }}
          {% endblocktranslate %}
          {% field_data titre_sejour_3_mois_parent_label accounting.titre_sejour_3_mois_parent %}
          {% blocktranslate with person_concerned=formatted_relationship trimmed asvar fiches_remuneration_parent_label %}
            Copy of the 6 salary slips issued in the 12 months preceding the application for registration or proof of
            receipt of unemployment benefit, pension or an indemnity from the mutual insurance company of
            {{ person_concerned }}
          {% endblocktranslate %}
          {% field_data fiches_remuneration_parent_label accounting.fiches_remuneration_parent %}
        {% elif accounting.sous_type_situation_assimilation_5 == 'PRIS_EN_CHARGE_OU_DESIGNE_CPAS' %}
          {% blocktranslate with person_concerned=formatted_relationship trimmed asvar attestation_cpas_parent_label %}
            Recent certificate of support from the CPAS of {{ person_concerned }}
          {% endblocktranslate %}
          {% field_data attestation_cpas_parent_label accounting.attestation_cpas_parent %}
        {% endif %}

      {% elif accounting.type_situation_assimilation == 'A_BOURSE_ARTICLE_105_PARAGRAPH_2' %}
        {% field_data _('Chosen assimilation') accounting.sous_type_situation_assimilation_6|enum_display:'ChoixAssimilation6' %}

        {% if accounting.sous_type_situation_assimilation_6 == 'A_BOURSE_ETUDES_COMMUNAUTE_FRANCAISE' %}
          {% field_data _('Copy of the decision to grant the scholarship from the CFWB') accounting.decision_bourse_cfwb %}
        {% elif accounting.sous_type_situation_assimilation_6 == 'A_BOURSE_COOPERATION_DEVELOPPEMENT' %}
          {% field_data _('Copy of the certificate of scholarship holder issued by the General Administration for Development Cooperation') accounting.attestation_boursier %}
        {% endif %}

      {% elif accounting.type_situation_assimilation == 'RESIDENT_LONGUE_DUREE_UE_HORS_BELGIQUE' %}
        {% field_data _('Chosen assimilation') accounting.type_situation_assimilation|enum_display:'TypeSituationAssimilation' %}

        {% field_data _('Copy of both sides of the identity document proving the long-term stay in a member state of the European Union') accounting.titre_identite_sejour_longue_duree_ue %}
        {% field_data _('Copy of both sides of the residence permit in Belgium') accounting.titre_sejour_belgique %}
      {% else %}
        {% field_data _('Assimilation situation that applies to you') accounting.type_situation_assimilation|enum_display:'TypeSituationAssimilation' %}
      {% endif %}

    {% endpanel %}
  {% endif %}

  {% panel _('Affiliations') %}
    {% if is_general %}
      {% field_data _('Do you wish to join the sports activities? If so, the cost of this membership will be added to your registration fee.') accounting.affiliation_sport|enum_display:'ChoixAffiliationSport' %}
    {% endif %}
    {% field_data _('Would you like to be a solidarity student, a program proposed by Louvain Coopération, the NGO of UCLouvain? This affiliation will give you access to a fund for your solidarity projects. If so, the cost of this affiliation, which is 12 EUR, will be added to your registration fees.') accounting.etudiant_solidaire %}
  {% endpanel %}

  {% panel _('Bank account') %}
    {% field_data _('Would you like to enter an account number so that we can process a refund if necessary?') accounting.type_numero_compte|enum_display:'ChoixTypeCompteBancaire' %}
    {% if accounting.type_numero_compte == 'IBAN' %}
      <dl>
        <dt>
          {% translate "IBAN account number" %}</dt>
        <dd>
          <span id="bank-account-iban-number">{{ accounting.numero_compte_iban}}</span>
          {% if accounting.iban_valide %}<i title="{% translate 'This number has been checked' %}" class="fa-solid fa-check"></i>{% endif %}
        </dd>
      </dl>
    {% elif accounting.type_numero_compte == 'AUTRE_FORMAT' %}
      {% field_data _('Account number') accounting.numero_compte_autre_format %}
      <div id="bank-account-bic-swift-number">
        {% field_data _('BIC/SWIFT code identifying the bank from which the account was opened') accounting.code_bic_swift_banque %}
      </div>
    {% endif %}
    {% if accounting.type_numero_compte == 'IBAN' or accounting.type_numero_compte == 'AUTRE_FORMAT' %}
      <div class="row">
        {% field_data _('First name of the account holder') accounting.prenom_titulaire_compte css_class="col-md-6" %}
        {% field_data _('Last name of the account holder') accounting.nom_titulaire_compte css_class="col-md-6"  %}
      </div>
    {% endif %}
  {% endpanel %}
{% endblock %}

{% block style %}
  {{ block.super }}
  <style>
    .fa-check {
      margin-left: 0.5em;
    }
  </style>
{% endblock %}

{% block script %}
  {{ block.super }}

  <script type="application/javascript" src="{% static 'jquery.mask.min.js' %}"></script>

  <script type="application/javascript">
      $(function () {
          $('#bank-account-bic-swift-number dd').mask('SSSS SS AA ZZZ', {
              translation:  {'Z': {pattern: /[a-zA-Z\d]/, optional: true}}
          });

          $('#bank-account-iban-number').mask('SS## ZZZZ ZZZZ ZZZZ ZZZZ ZZZZ ZZZZ ZZZZ ZZ', {
              translation:  {'Z': {pattern: /[a-zA-Z\d]/, optional: true}}
          });
      })
  </script>
{% endblock %}
