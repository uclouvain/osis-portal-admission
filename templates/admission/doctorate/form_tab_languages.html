{% extends "admission/doctorate/form_tab_layout.html" %}{% load bootstrap3 i18n static admission %}

{% comment "License" %}
  * OSIS stands for Open Student Information System. It's an application
  * designed to manage the core business of higher education institutions,
  * such as universities, faculties, institutes and professional schools.
  * The core business involves the administration of students, teachers,
  * courses, programs and so on.
  *
  * Copyright (C) 2015-2021 Universit√© catholique de Louvain
  (http://www.uclouvain.be)
  *
  * This program is free software: you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
  * the Free Software Foundation, either version 3 of the License, or
  * (at your option) any later version.
  *
  * This program is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  * GNU General Public License for more details.
  *
  * A copy of this license - GNU General Public License - is available
  * at the root of the source code of this program.  If not,
  * see http://www.gnu.org/licenses/.
{% endcomment %}

{% block style %}
  <style>
    label {
      display: block;
    }
    .slider.slider-horizontal {
      width: 95%!important;
      margin: 0 15px;
    }
  </style>
{% endblock %}

{% block form %}

  {% bootstrap_formset_errors form %}
  {{ form.management_form }}

  {% panel _("Languages knowledge") %}
      {% for language_form in form %}
        <div class="language-form-container">
          {% panel _("Add a language") %}
            {% bootstrap_form language_form %}
            <button class="align-self-center btn btn-danger delete-language-form">{% trans "Delete" %}</button>
          {% endpanel %}
        </div>
      {% endfor %}
      <button id="add-language-form-btn" class="btn btn-primary btn-block">{% trans "Add another language" %}</button>
  {% endpanel %}

{% endblock %}

{% block script %}
  {{ form.media }}
  <script type="text/javascript">
    $(function() {
      let addLanguageFormBtn = $("#add-language-form-btn");
      let languageFormContainer = $(".language-form-container");
      let totalForms = $("#id_form-TOTAL_FORMS");
      let formCount = languageFormContainer.length - 1;
      let mainForm = $(".osis-form");

      function updateForms() {
        languageFormContainer.each(function(index) {
          $(this).html($(this).html().replaceAll(/form-(\d+)-/g, `form-${index}-`))
        });
      }

      mainForm.click(function(event) {
        if(event.target.classList.contains('delete-language-form')) {
          event.preventDefault();
          event.target.parentElement.parentElement.remove();
          formCount--;
          totalForms.attr('value', `${formCount + 1}`);
          updateForms();
        }
      });

      addLanguageFormBtn.click(function(event) {
        event.preventDefault();
        formCount++;
        // clone and insert new language form
        let newLanguageForm = languageFormContainer.last().clone({deepWithDataAndEvents: true});
        newLanguageForm.html(newLanguageForm.html().replaceAll(/form-(\d+)-/g, `form-${formCount}-`));
        newLanguageForm.insertBefore(addLanguageFormBtn);
        totalForms.attr('value', `${formCount + 1}`);
      });
    });
  </script>
{% endblock %}
