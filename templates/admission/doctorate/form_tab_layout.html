{% extends "layout.html" %}{% load bootstrap3 i18n static admission %}

{% comment "License" %}
* OSIS stands for Open Student Information System. It's an application
* designed to manage the core business of higher education institutions,
* such as universities, faculties, institutes and professional schools.
* The core business involves the administration of students, teachers,
* courses, programs and so on.
*
* Copyright (C) 2015-2022 Université catholique de Louvain (http://www.uclouvain.be)
*
* This program is free software: you can redistribute it and/or modify
* it under the terms of the GNU General Public License as published by
* the Free Software Foundation, either version 3 of the License, or
* (at your option) any later version.
*
* This program is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
* GNU General Public License for more details.
*
* A copy of this license - GNU General Public License - is available
* at the root of the source code of this program.  If not,
* see http://www.gnu.org/licenses/.
{% endcomment %}

{% block style %}
  <link href="{% static "admission/admission.css" %}" rel="stylesheet"/>
  <style>
    .form-group.required_field .control-label:after, .required_text:after {
      content: " *";
      color: red;
    }
  </style>
{% endblock %}

{% block script %}
  <script type="text/javascript">
  // Notify user when something in a form has changed
  var initialData = {};
  var checkForm = true;
  document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('form').forEach(function (form) {
          var action = form.getAttribute('action');
          var formData = new FormData(form);
          var searchParams = new URLSearchParams(formData);
          initialData[action] = searchParams.toString();
          form.addEventListener('submit', function () {
              checkForm = false;
          });
      });
  });
  window.addEventListener('beforeunload', function (e) {
      if (checkForm) {
          document.querySelectorAll('form').forEach(function (form) {
              var action = form.getAttribute('action');
              var formData = new FormData(form);
              var searchParams = new URLSearchParams(formData);
              if (initialData[action] !== searchParams.toString()) {
                  // Cancel the event
                  e.preventDefault(); // If you prevent default behavior in Mozilla Firefox prompt will always be shown
                  // Chrome requires returnValue to be set
                  return e.returnValue = "{% trans "You may lose your changes, are you sure you want to quit?" %}"
              }
          });
      }
  });
  </script>
{% endblock %}

{% block breadcrumb_area %}
  {% if admission and admission.matricule_candidat != user.person.global_id %}
    {% url 'admission:supervised-list' as list_url %}
  {% else %}
    {% url 'admission:doctorate-list' as list_url %}
  {% endif %}
  <ol class="breadcrumb">
    <li>
      <a href="{{ list_url }}">{% trans "Doctorate admissions" %}</a>
    </li>
    {% if admission %}
      <li class="active">
        {{ admission.intitule_doctorat }} ({{ admission.reference }})
      </li>
    {% else %}
      <li class="active">{% trans "Create new doctorate admission" %}</li>
    {% endif %}
  </ol>
{% endblock %}

{% block content %}
  {% if admission and admission.matricule_candidat != user.person.global_id %}
    {% url 'admission:supervised-list' as list_url %}
  {% else %}
    {% url 'admission:doctorate-list' as list_url %}
  {% endif %}
  <div class="page-header h3 clearfix">
    <span class="d-inline-block">
      {% if admission %}
        {{ admission.intitule_doctorat }}
      {% else %}
        {% trans "Create new doctorate admission" %}
      {% endif %}
    </span>
    <a href="{{ list_url }}" class="pull-right h5 text-primary">
      <span class="fa fa-stream"></span>
      {% trans "Back to requests" %}
    </a>
  </div>

    <div class="well">
        <div>
            {% trans "Reference:" %}
            {% if not admission %}
                {% trans "No reference yet - Go to Project tab" %}
            {% else %}
                {{ admission.intitule_doctorat }} ({{ admission.reference }})
            {% endif %}
        </div>
        <div>
            {% trans "Status:" %}
            {% if not admission %}
                {% trans "Not submitted" %}
            {% else %}
                {{ admission.statut|enum_display:'ChoixStatutProposition' }}
            {% endif %}
        </div>
    </div>

    <p><em>
        {% blocktrans %}
            The online enrolment request procedure is split up into several
            sheet. The enrolment request can only be validated as soon as all
            sheets have been duly completed. The icons will remind you of the
            state of progress of your enrolment request which you can interrupt
            and resume at any moment.
        {% endblocktrans %}
    </em></p>

    {% include "template_messages.html" %}

    {% url "admission:doctorate:"|add:request.resolver_match.url_name view.kwargs.pk as cancel_url %}

    {% block tab_content %}
        <form class="osis-form" method="post" action="">
            {% csrf_token %}
            {% block form_content %}
                {% doctorate_tabs admission with_submit=True %}
                <div class="row">
                    <div class="col-md-2 visible-md visible-lg">
                        {% doctorate_subtabs admission %}
                    </div>
                    <div class="col-md-10">
                        {% block form %}{% endblock %}
                        {% block submit_button_bottom %}
                                <div class="text-right form-group">
                                    <button
                                        type="submit" class="btn btn-primary"
                                        {% if cancel_url and not admission|can_update_tab:request.resolver_match.url_name %}
                                        disabled
                                        {% endif %}
                                    >
                                    <span
                                        class="glyphicon glyphicon-floppy-save"
                                        aria-hidden="true"
                                    ></span>
                                        {% trans 'Save' %}
                                    </button>
                                </div>
                        {% endblock submit_button_bottom %}
                    </div>
                </div>
            {% endblock form_content %}
        </form>
    {% endblock %}
{% endblock %}
