{% extends "admission/doctorate/form_tab_layout.html" %}{% load bootstrap3 i18n static admission %}

{% comment "License" %}
    * OSIS stands for Open Student Information System. It's an application
    * designed to manage the core business of higher education institutions,
    * such as universities, faculties, institutes and professional schools.
    * The core business involves the administration of students, teachers,
    * courses, programs and so on.
    *
    * Copyright (C) 2015-2021 Universit√© catholique de Louvain
    (http://www.uclouvain.be)
    *
    * This program is free software: you can redistribute it and/or modify
    * it under the terms of the GNU General Public License as published by
    * the Free Software Foundation, either version 3 of the License, or
    * (at your option) any later version.
    *
    * This program is distributed in the hope that it will be useful,
    * but WITHOUT ANY WARRANTY; without even the implied warranty of
    * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    * GNU General Public License for more details.
    *
    * A copy of this license - GNU General Public License - is available
    * at the root of the source code of this program.  If not,
    * see http://www.gnu.org/licenses/.
{% endcomment %}

{% block form %}
    {% bootstrap_form_errors main_form %}
    {% bootstrap_form_errors foreign_diploma_form %}
    {% bootstrap_form_errors belgian_diploma_form %}
    {% bootstrap_form_errors schedule_form %}

    <div class="row">
        <div class="col-md-12">{% bootstrap_field main_form.got_diploma %}</div>
    </div>

    {# Hide it by default to prevent FOUC #}
    <div id="got-diploma" style="display: none">
        <div class="row">
            <div class="col-md-6">{% bootstrap_field main_form.academic_graduation_year %}</div>
            <div class="col-md-6">{% bootstrap_field main_form.diploma_type %}</div>
        </div>

        {% panel _("Foreign diploma") id="foreign-diploma" %}
            {% bootstrap_field foreign_diploma_form.foreign_diploma_type %}
            {% bootstrap_field foreign_diploma_form.linguistic_regime %}
            {% bootstrap_field foreign_diploma_form.other_linguistic_regime %}
            {% bootstrap_field foreign_diploma_form.country %}
        {% endpanel %}

        {% panel _("Belgian diploma") id="belgian-diploma" %}
            {% panel _("Community of education") %}
                {% bootstrap_field belgian_diploma_form.community %}
            {% endpanel %}

            {% panel _("Type of education") id="education-type" %}
                <div class="form-group {% if belgian_diploma_form.educational_type.errors %}has-error{% elif belgian_diploma_form.is_bound %}has-success{% endif %}">
                    <p>{% bootstrap_label belgian_diploma_form.educational_type.label_tag label_class="control-label" %}</p>
                    {% for radio in belgian_diploma_form.educational_type %}
                        {% if radio.data.value == "TEACHING_OF_GENERAL_EDUCATION" %}
                            {% bootstrap_label _(">> Educational transition :") label_class="control-label" %}
                        {% elif radio.data.value == "QUALIFICATION_METHOD" %}
                            {% bootstrap_label _(">> Educational  qualification :") label_class="control-label" %}
                        {% endif %}
                        <div class="radio">
                            {{ radio }}
                        </div>
                    {% endfor %}
                    {% if belgian_diploma_form.educational_type.errors %}
                        {% for error in belgian_diploma_form.educational_type.errors %}
                            <div class="help-block">{{ error|escape }}</div>
                        {% endfor %}
                    {% endif %}
                </div>

                {% bootstrap_field belgian_diploma_form.educational_other %}
            {% endpanel %}

            {% trans "Course" context "trajectory" as course_panel_title %}
            {% panel course_panel_title %}
                {% bootstrap_field belgian_diploma_form.course_repeat %}
                {% bootstrap_field belgian_diploma_form.course_orientation %}
            {% endpanel %}

            {% panel _("Institute") %}
                <p>
                    <strong>{% trans "What is the name of the educational institute that has provided to you a certificate of upper-secundary education (C.E.S.S.)?" %}</strong>
                </p>
                <p class="text-secondary">{% trans "In order to help you at this matter, we propose you to perform a search based on the location or postal code." %}</p>
                {% bootstrap_field belgian_diploma_form.institute %}
                {% bootstrap_field belgian_diploma_form.other_institute %}
            {% endpanel %}

            {% panel _("Schedule") id="schedule" %}
                <p>{% blocktrans %}
                    Please complete here below the schedule of your last year
                    of high school, indicating for each domain the number of
                    hours of education followed per week (h/w).
                {% endblocktrans %}</p>

                <div class="row">
                    <div class="col-md-4">
                        {% panel _("Ancient languages") %}
                            {% bootstrap_field schedule_form.latin addon_after=_("h/w") %}
                            {% bootstrap_field schedule_form.greek addon_after=_("h/w") %}
                        {% endpanel %}

                        {% panel _("Sciences") %}
                            {% bootstrap_field schedule_form.chemistry addon_after=_("h/w") %}
                            {% bootstrap_field schedule_form.physic addon_after=_("h/w") %}
                            {% bootstrap_field schedule_form.biology addon_after=_("h/w") %}
                        {% endpanel %}
                    </div>

                    <div class="col-md-4">
                        {% panel _("Modern languages") %}
                            {% bootstrap_field schedule_form.german addon_after=_("h/w") %}
                            {% bootstrap_field schedule_form.dutch addon_after=_("h/w") %}
                            {% bootstrap_field schedule_form.english addon_after=_("h/w") %}
                            {% bootstrap_field schedule_form.french addon_after=_("h/w") %}

                            <div class="form-group {% if schedule_form.modern_languages_other_label.errors or schedule_form.modern_languages_other_hours.errors %}has-error{% elif schedule_form.is_bound %}has-success{% endif %}">
                                {% bootstrap_label schedule_form.modern_languages_other_label.label label_for=schedule_form.modern_languages_other_label.id_for_label label_class="control-label" %}
                                <div class="input-group">
                                    <input
                                        type="text"
                                        name="schedule-modern_languages_other_label"
                                        class="form-control"
                                        title=""
                                        id="id_schedule-modern_languages_other_label"
                                        value="{{ schedule_form.modern_languages_other_label.value }}"
                                    />
                                    <span class="input-group-addon">:</span>
                                    <input
                                        type="number"
                                        name="schedule-modern_languages_other_hours"
                                        class="form-control"
                                        title=""
                                        id="id_schedule-modern_languages_other_hours"
                                        value="{{ schedule_form.modern_languages_other_hours.value }}"
                                    />
                                    <div class="input-group-addon">{% trans "h/w" %}</div>
                                </div>
                                {% if schedule_form.modern_languages_other_label.errors %}
                                    {% for error in schedule_form.modern_languages_other_label.errors %}
                                        <div class="help-block">{{ error|escape }}</div>
                                    {% endfor %}
                                {% endif %}
                                {% if schedule_form.modern_languages_other_hours.errors %}
                                    {% for error in schedule_form.modern_languages_other_hours.errors %}
                                        <div class="help-block">{{ error|escape }}</div>
                                    {% endfor %}
                                {% endif %}
                            </div>
                        {% endpanel %}
                    </div>

                    <div class="col-md-4">
                        {% panel _("Others")|add:_(" (h/w)") %}
                            {% bootstrap_field schedule_form.mathematics addon_after=_("h/w") %}
                            {% bootstrap_field schedule_form.it addon_after=_("h/w") %}
                            {% bootstrap_field schedule_form.social_sciences addon_after=_("h/w") %}
                            {% bootstrap_field schedule_form.economic_sciences addon_after=_("h/w") %}

                            <div class="form-group {% if schedule_form.other_label.errors or schedule_form.other_hours.errors %}has-error{% elif schedule_form.is_bound %}has-success{% endif %}">
                                {% bootstrap_label schedule_form.other_label.label label_for=schedule_form.other_label.id_for_label label_class="control-label" %}
                                <div class="input-group">
                                    <input
                                        type="text"
                                        name="schedule-other_label"
                                        class="form-control"
                                        title=""
                                        id="id_schedule-other_label"
                                        value="{{ schedule_form.other_label.value }}"
                                    />
                                    <span class="input-group-addon">:</span>
                                    <input
                                        type="number"
                                        name="schedule-other_hours"
                                        class="form-control"
                                        title=""
                                        id="id_schedule-other_hours"
                                        value="{{ schedule_form.other_hours.value }}"
                                    />
                                    <div class="input-group-addon">{% trans "h/w" %}</div>
                                </div>
                                {% if schedule_form.other_label.errors %}
                                    {% for error in schedule_form.other_label.errors %}
                                        <div class="help-block">{{ error|escape }}</div>
                                    {% endfor %}
                                {% endif %}
                                {% if schedule_form.other_hours.errors %}
                                    {% for error in schedule_form.other_hours.errors %}
                                        <div class="help-block">{{ error|escape }}</div>
                                    {% endfor %}
                                {% endif %}
                            </div>
                        {% endpanel %}
                    </div>
                </div>
            {% endpanel %}
        {% endpanel %}

        {% panel _("At which result level do you consider yourself?") %}
            {% bootstrap_field main_form.result %}
        {% endpanel %}
    </div>

{% endblock %}

{% block script %}
    {{ form.media }}
    {{ foreign_diploma_form.media }}
    <script type="application/javascript">
    $(function () {
        function setNullValue(selector) {
            $('select,textarea,input[type!=radio]', selector).val(null).trigger('change');
            $('input[type=radio]', selector).prop('checked', false);
        }

        $('#got-diploma').dependsOn({
            'input[name=got_diploma]': { values: ['True'] },
        }, {
            onDisable: function () {
                setNullValue('#got-diploma');
                setNullValue('#foreign-diploma');
                setNullValue('#belgian-diploma');
                setNullValue('#schedule');
            },
        });

        $('#foreign-diploma').dependsOn({
            'input[name=diploma_type]': { values: ['FOREIGN'] },
        }, {
            onDisable: function () {
                setNullValue('#diploma_type')
            },
        });

        $('#belgian-diploma').dependsOn({
            'input[name=diploma_type]': { values: ['BELGIAN'] },
        }, {
            onDisable: function () {
                setNullValue('#diploma_type')
            },
        });
        $('#education-type').dependsOn({
            'input[name=belgian_diploma-community]': { values: ['FRENCH_SPEAKING'] },
        }, {
            onDisable: function () {
                setNullValue('#belgian_diploma-community')
            },
        });
        $('#schedule').dependsOn({
            'input[name=belgian_diploma-educational_type]': { values: ['TEACHING_OF_GENERAL_EDUCATION', 'TRANSITION_METHOD', 'ARTISTIC_TRANSITION'] },
        }, {
            onDisable: function () {
                setNullValue('#schedule')
            },
        });

        var context = $('.osis-form');

        var institute = context.find('input[name=belgian_diploma-institute]');
        var otherInstitute = context.find('input[name=belgian_diploma-other_institute]');

        otherInstitute.on('focus', function () {
            institute.val(null);
        });
        institute.on('focus', function () {
            otherInstitute.val(null);
        });

        var education = context.find('input[name=belgian_diploma-educational_type]');
        var otherEducation = context.find('input[name=belgian_diploma-educational_other]');

        otherEducation.on('focus', function () {
            {# Set the value of education to hide the schedule panel and then disable it #}
            education.prop('checked', false);
            education.val('TEACHING_OF_GENERAL_EDUCATION').trigger('change');
        });
        education.on('focus', function () {
            otherEducation.val(null);
        });

        var linguistic_regime = context.find('select[name=foreign_diploma-linguistic_regime]');
        var other_linguistic_regime = context.find('input[name=foreign_diploma-other_linguistic_regime]');

        other_linguistic_regime.on('focus', function () {
            linguistic_regime.val(null).change();
        });
        linguistic_regime.on('select2:select', function () {
            other_linguistic_regime.val(null);
        });
    });
    </script>
{% endblock %}
